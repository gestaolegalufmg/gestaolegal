{% extends "base/painel_principal.html" %}

{% block page_title %}Notificações{% endblock page_title %}
{% block titulo %}
<h1>Notificações</h1>
{% endblock titulo %}

{% block css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/table_styles.css') }}">
{% endblock %}

{% import 'macros/listing.html' as listui %}
{% block conteudo %}
{% macro page_link(p) %}{{ url_for('notificacoes.index', page=p, valor_busca=valor_busca, tipo_busca=tipo_busca) }}{% endmacro %}
{% macro carater_label(row) %}{{ row.carater or '--' }}{% endmacro %}
{% macro data_label(row) %}{{ row.data_criacao.strftime('%d/%m/%Y %H:%M') if row.data_criacao else '--' }}{% endmacro %}
{% macro criador_label(row) %}{{ row.criador.nome if row.criador else '--' }}{% endmacro %}
{% macro origem_cell(row) %}
{{ listui.action_buttons([
  {'label':'Ir à página','href':url_for('notificacoes.ir_a_pagina', id=row.id),'visible':true,'variant':'btn-info'}
]) }}
{% endmacro %}
{% set items = notificacoes.items if notificacoes and notificacoes.items is defined else notificacoes %}
{% set total_notif = (notificacoes.total if notificacoes and notificacoes.total is defined else (items|length if items else 0)) %}
{% set columns = [
  {'title':'Caráter da Notificação','renderer': carater_label},
  {'title':'Data','renderer': data_label},
  {'title':'Criador','renderer': criador_label},
  {'title':'Página de Origem','renderer': origem_cell}
] %}
{% call(list_slot) listui.listing_layout(url_for('notificacoes.index'), total=total_notif) %}
  {% if list_slot == 'filters' %}
    <div class="search-field">
      <label>Buscar:</label>
      <input type="text" name="valor_busca" value="{{ valor_busca or '' }}" placeholder="Caráter, criador...">
    </div>
    <div class="search-field">
      <select name="tipo_busca">
        <option value="todos" {% if tipo_busca == 'todos' or not tipo_busca %}selected{% endif %}>Todos</option>
        <option value="info" {% if tipo_busca == 'info' %}selected{% endif %}>Informação</option>
        <option value="warning" {% if tipo_busca == 'warning' %}selected{% endif %}>Aviso</option>
        <option value="error" {% if tipo_busca == 'error' %}selected{% endif %}>Erro</option>
      </select>
    </div>
  {% elif list_slot == 'content' %}
    {% if items and items|length > 0 %}
      {{ listui.table(columns, items) }}
      {% if notificacoes and notificacoes.pages is defined %}
        {{ listui.pagination(notificacoes, page_link) }}
      {% endif %}
    {% else %}
      {{ listui.empty_state('Nenhuma notificação encontrada', valor_busca and ('Não foram encontrados resultados para "' ~ valor_busca ~ '"') or 'Não há notificações cadastradas no momento') }}
    {% endif %}
  {% endif %}
{% endcall %}
{% endblock conteudo %}

{% block scripts %}
<script src="{{url_for('static',filename='js/form_utilities.js')}}"></script>
<script>
FormUtils.setupAutoSubmit('select[name="tipo_busca"]');
</script>
{% endblock %}
{% extends "base/painel_principal.html" %}

{% block page_title %}Orientações Jurídicas{% endblock page_title %}
{% block titulo %}
<h1>Orientações Jurídicas</h1>
{% endblock titulo %}

{% import 'macros/listing.html' as listui %}
{% block conteudo %}
{% macro page_link(p) %}{{ url_for('orientacao_juridica.orientacoes_juridicas', page=p, busca=busca) }}{% endmacro %}
{% macro area_label(row) %}{{ row.area_direito }}{% endmacro %}
{% macro partes_label(row) %}
  {% for atendido in row.atendidos %}
    {{ atendido.nome }}<br />
  {% endfor %}
{% endmacro %}
{% macro data_label(row) %}{{ row.data_criacao.strftime("%d/%m/%Y %H:%M") if row.data_criacao else "--" }}{% endmacro %}
{% macro actions_cell(row) %}
{{ listui.action_buttons([
  {'label':'', 'href':url_for('orientacao_juridica.perfil_oj', id=row.id), 'visible':true, 'variant':'btn-primary', 'icon':'icon icon-eye', 'title':'Visualizar orientação jurídica'},
  {'label':'', 'href':url_for('orientacao_juridica.editar_orientacao_juridica', id_oj=row.id), 'visible': current_user.urole in [UserRole.ADMINISTRADOR.value, UserRole.PROFESSOR.value], 'variant':'btn-primary', 'icon':'icon icon-edit', 'title':'Editar orientação jurídica'},
  {'label':'', 'tag':'button', 'visible': current_user.urole in [UserRole.ADMINISTRADOR.value, UserRole.ESTAGIARIO_DIREITO.value, UserRole.PROFESSOR.value], 'variant':'btn-primary', 'icon':'icon icon-link', 'title':'Associar atendido', 'attrs': {'data-toggle':'modal', 'data-target':'#modalAssociarAtendido', 'data-orientacao-id': row.id}},
  {'label':'', 'href':url_for('orientacao_juridica.excluir_oj'), 'method':'POST', 'csrf': csrf_token(), 'hidden': {'id_orientacao': row.id}, 'confirm':'Você deseja realmente excluir essa orientação jurídica?', 'visible': current_user.urole == UserRole.ADMINISTRADOR.value, 'variant':'btn-danger', 'icon':'icon icon-trash', 'title':'Excluir orientação jurídica'}
]) }}
{% endmacro %}
{% set items = orientacoes.items if orientacoes and orientacoes.items is defined else orientacoes %}
{% set total_orients = (orientacoes.total if orientacoes and orientacoes.total is defined else (items|length if items else 0)) %}
{% set columns = [
  {'title':'Área do Direito','renderer': area_label},
  {'title':'Partes Envolvidas','renderer': partes_label},
  {'title':'Data/Hora de Criação','renderer': data_label},
  {'title':'Ações','renderer': actions_cell}
] %}
{% call(list_slot) listui.listing_layout(url_for('orientacao_juridica.orientacoes_juridicas'), total=total_orients) %}
  {% if list_slot == 'filters' %}
    <div class="search-field">
      <label>Buscar:</label>
      <input type="text" name="busca" value="{{ busca or '' }}" class="form-control form-control-sm" placeholder="Área do direito, partes envolvidas..." aria-controls="table-2">
    </div>
  {% elif list_slot == 'header_actions' %}
    <a class="btn btn-primary" href="{{ url_for('orientacao_juridica.cadastro_orientacao_juridica') }}">Cadastrar Orientação Jurídica</a>
  {% elif list_slot == 'content' %}
    {% if items and items|length > 0 %}
      {{ listui.table(columns, items) }}
      {% if orientacoes and orientacoes.pages is defined %}
        {{ listui.pagination(orientacoes, page_link) }}
      {% endif %}
    {% else %}
      {{ listui.empty_state('Nenhuma orientação jurídica encontrada', 'Não há orientações jurídicas cadastradas no momento', url_for('orientacao_juridica.cadastro_orientacao_juridica'), 'Cadastrar nova orientação jurídica') }}
    {% endif %}
  {% endif %}
{% endcall %}
{% endblock conteudo %}

{% block scripts %}
<style>
  /* Page Container */
  .page-container {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    padding: 24px;
    margin-bottom: 24px;
  }

  /* Page Header */
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 24px;
    flex-wrap: wrap;
    gap: 16px;
  }

  .search-section {
    display: flex;
    align-items: center;
    gap: 16px;
    flex-wrap: wrap;
  }

  .search-form {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
  }

  .search-field {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .search-field label {
    font-weight: 500;
    color: #333;
    white-space: nowrap;
  }

  .search-field input,
  .search-field select {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 14px;
    min-width: 200px;
  }

  .search-field input:focus,
  .search-field select:focus {
    outline: none;
    border-color: #007bff;
    box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
  }

  .total-info {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #666;
  }

  .total-badge {
    background-color: var(--color-primary);
    color: white;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 500;
  }

  .action-section {
    display: flex;
    align-items: center;
  }

  /* Table */
  .table-container {
    overflow-x: auto;
    margin-bottom: 24px;
  }

  .results-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
  }

  .results-table th {
    background-color: #f8f9fa;
    padding: 12px;
    text-align: left;
    font-weight: 600;
    color: #333;
    border-bottom: 2px solid #dee2e6;
  }

  .results-table td {
    padding: 12px;
    border-bottom: 1px solid #dee2e6;
    vertical-align: middle;
  }

  .results-table tbody tr:hover {
    background-color: #f8f9fa;
  }

  .status-text {
    color: #6c757d;
    font-style: italic;
  }

  .inline-form {
    display: inline;
  }

  /* Pagination */
  .pagination-section {
    margin-top: 24px;
  }

  .pagination-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
    flex-wrap: wrap;
    gap: 16px;
  }

  .results-text,
  .page-info {
    color: #6c757d;
    font-size: 14px;
  }

  .pagination-nav {
    display: flex;
    justify-content: center;
  }

  .pagination {
    display: flex;
    list-style: none;
    padding: 0;
    margin: 0;
    gap: 4px;
  }

  .page-item {
    display: flex;
  }

  .page-link {
    padding: 8px 12px;
    border: 1px solid #dee2e6;
    color: #007bff;
    text-decoration: none;
    border-radius: 4px;
    transition: all 0.2s;
    cursor: pointer;
  }

  .page-link:hover {
    background-color: #e9ecef;
    border-color: #adb5bd;
  }

  .page-item.active .page-link {
    background-color: #007bff;
    border-color: #007bff;
    color: white;
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 48px 24px;
    color: #6c757d;
  }

  .empty-state h4 {
    margin-bottom: 16px;
    color: #333;
  }

  .empty-message {
    margin-bottom: 24px;
    font-size: 16px;
  }

  /* Modal Styles */
  .modal-backdrop {
    z-index: 9998 !important;
  }
  .modal {
    z-index: 9999 !important;
    padding-left: 250px !important;
  }
  .modal-dialog {
    margin: 15vh auto 5vh auto !important;
    max-height: 80vh !important;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .page-header {
      flex-direction: column;
      align-items: stretch;
    }

    .search-section {
      flex-direction: column;
      align-items: stretch;
    }

    .search-form {
      flex-direction: column;
      align-items: stretch;
    }

    .search-field {
      flex-direction: column;
      align-items: stretch;
    }

    .search-field input,
    .search-field select {
      min-width: auto;
    }

    .pagination-info {
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .table-container {
      font-size: 14px;
    }

    .results-table th,
    .results-table td {
      padding: 8px;
    }
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchForm = document.querySelector('.search-form');
    const buscaInput = document.getElementById('busca');
    
    if (searchForm) {
        searchForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(searchForm);
            const params = new URLSearchParams();
            
            for (let [key, value] of formData.entries()) {
                if (value && value.trim() !== '') {
                    params.set(key, value);
                }
            }
            
            window.location.href = searchForm.action + '?' + params.toString();
        });
    }
});
</script>

<script src="{{ url_for('static', filename='js/modal_associar_atendido.js') }}"></script>

{% endblock scripts %}

{% extends "base/painel_principal.html" %}
{%block titulo%}
Edição de {{atendido.nome.capitalize()}}
{%endblock%}

{% block css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/form_styles.css') }}">
{% endblock %}

{% block conteudo %}
<div class="form-container" id = "pessoa">
    <div class="form-content">
        <div class= "form-validation">
            <form action="{{url_for('atendido.editar_unificado', id_atendido = atendido.id)}}" method="POST" id="form">
                <input value="{{atendido.email}}" name="emailAtual" type="hidden">

                {% include "atendidos/formularios/formulario_atendido.html" %}

                {% if form_assistido %}
                    {% with form=form_assistido %}
                        {% include "atendidos/formularios/formulario_assistido.html" %}
                    {% endwith %}
                {% endif %}
                
                <button type="submit" class="btn btn-primary" id="button">Salvar Alteração</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{url_for('static',filename='js/form_utilities.js')}}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        FormUtils.initializeFormWithValidation({
            formId: 'form',
            buttonId: 'button',
            masks: [
                { selector: '#formcpf', pattern: FormUtils.MASK_PATTERNS.CPF },
                { selector: '#formcpfrepr', pattern: FormUtils.MASK_PATTERNS.CPF },
                { selector: '#formcnpj', pattern: FormUtils.MASK_PATTERNS.CNPJ },
                { selector: '#formcel', pattern: FormUtils.MASK_PATTERNS.CELL_PHONE },
                { selector: '#formtel', pattern: FormUtils.MASK_PATTERNS.PHONE },
                { selector: '#formcep', pattern: FormUtils.MASK_PATTERNS.CEP }
            ],
            conditionalFields: [
                {
                    triggerId: 'pj_constituida',
                    fieldsToToggle: ['div_cnpj'],
                    condition: (trigger) => trigger.value === 'True'
                },
                {
                    triggerId: 'pj_constituida',
                    fieldsToToggle: ['div_repres_legal'],
                    condition: (trigger) => trigger.value === 'True'
                },
                {
                    triggerId: 'repres_legal',
                    fieldsToToggle: ['div_nome_repres_legal', 'div_cpf_repres_legal', 'div_contato_repres_legal', 'div_nascimento_repres_legal', 'div_rg_repres_legal'],
                    condition: (trigger) => trigger.value === '0' || trigger.value === 'False'
                },
                {
                    triggerId: 'como_conheceu',
                    fieldsToToggle: ['div_indicacao_orgao'],
                    condition: (trigger) => trigger.options[trigger.selectedIndex]?.text === '{{como_conheceu_daj["ORGAOSPUBLICOS"][1]}}'
                },
                {
                    triggerId: 'procurou_outro_local',
                    fieldsToToggle: ['div_procurou_qual_local'],
                    condition: (trigger) => trigger.value === 'True' || trigger.value === '1'
                }
            ],
            dateRanges: [],
            preventWheel: true,
            enableValidation: true
        });
    });
    </script>
{%endblock%}



{% macro form_field(field, field_id=None, field_type=None, required=false, extra_classes="") %}
{% set is_required = required or ('required' in field.flags) %}
{% set classes = (extra_classes ~ (' is-invalid' if field.errors else '')) %}
<div class="form-field" {% if field_id %}id="{{ field_id }}"{% endif %}>
    <div class="field-row">
        <label for="{{ field.id }}">{{ field.label }}{% if is_required %} <span class="required">*</span>{% endif %}</label>
        <div class="field-input">
            {% if field_type %}
                {{ field(type=field_type, class_=classes, required=is_required, aria_invalid=('true' if field.errors else 'false')) }}
            {% else %}
                {{ field(class_=classes, required=is_required, aria_invalid=('true' if field.errors else 'false')) }}
            {% endif %}
            {% if field.errors %}
            <div class="invalid-feedback">{{ field.errors[0] }}</div>
            {% endif %}
        </div>
    </div>
</div>
{% endmacro %}

{% macro form_section(title) %}
<div class="form-section">
    <h3>{{ title }}</h3>
</div>
{% endmacro %}

{% macro form_field_split(field, checkbox_id, checkbox_label, required=false) %}
{% set is_required = required or ('required' in field.flags) %}
{% set classes = ('is-invalid' if field.errors else '') %}
<div class="form-field">
    <div class="field-row">
        <label for="{{ field.id }}">{{ field.label }}{% if is_required %} <span class="required">*</span>{% endif %}</label>
        <div class="field-input field-input-split">
            <div class="field-input-main">
                {{ field(type="text", required=is_required, class_=classes, aria_invalid=('true' if field.errors else 'false')) }}
                {% if field.errors %}
                <div class="invalid-feedback">{{ field.errors[0] }}</div>
                {% endif %}
            </div>
            <div class="field-input-checkbox">
                <input type="checkbox" id="{{ checkbox_id }}">
                <label for="{{ checkbox_id }}">{{ checkbox_label }}</label>
            </div>
        </div>
    </div>
</div>
{% endmacro %}

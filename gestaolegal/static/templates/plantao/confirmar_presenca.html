{% extends "base/painel_principal.html" %}

{% block css %}
<link rel="stylesheet" href="{{url_for('static',filename='css/table_styles.css')}}">
<style>
.radio-group {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  align-items: center;
}

.radio-group .radio-option {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.25rem 0.5rem;
  border-radius: 0.25rem;
  transition: background-color 0.2s;
}

.radio-group .radio-option:hover {
  background-color: var(--color-gray-100);
}

.radio-group .radio-option input[type="radio"] {
  margin: 0;
}

.radio-group .radio-option label {
  margin: 0;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
}

.radio-group .radio-option input[type="radio"]:checked + label {
  font-weight: 600;
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
  flex-wrap: wrap;
  gap: 1rem;
}

.page-header h1 {
  margin: 0;
  color: var(--color-page-title);
}

.form-section {
  margin: 2rem 0 1.5rem 0;
  padding-bottom: 1rem;
  border-bottom: 2px solid var(--color-border);
}

.form-section h3 {
  margin: 0 0 0.5rem 0;
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--color-text);
}

.form-section p {
  margin: 0;
  font-size: 0.875rem;
  color: var(--color-text-muted);
}

@media (max-width: 768px) {
  .page-header {
    flex-direction: column;
    align-items: stretch;
  }
  
  .radio-group {
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: center;
  }
}
</style>
{% endblock %}

{% block conteudo %}
<meta name="csrf-token" content="{{ csrf_token() }}">
<input type="hidden" id="hdnAjaxBuscaPresencasData" value="{{url_for('plantao.ajax_busca_presencas_data')}}">

{% block titulo %} {% endblock %}
<div class="page-container">
  <div class="page-header">
    <h1>Confirmar Presença</h1>
    <div class="search-field">
      <label>Data:</label>
      <input type="date" value="{{data_ontem.strftime('%Y-%m-%d')}}" id="dataProcurada" class="form-input">
    </div>
  </div>
</div>

<div class="text-center">
  <img src="{{url_for('static', filename='imgs_daj/Rolling-3.3s-331px.svg')}}" class="d-none" id="loadingGIF">
</div>

<div class="page-container" id="conteudoPagina">
  <div class="empty-state d-none" id="semPresenca">
    <h3>Nenhuma presença a ser confirmada para esta data!</h3>
    <p>Selecione uma data diferente ou verifique se há registros de presença.</p>
  </div>

  <form action="" method="POST" class="form-container" id="confirmacaoForm">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

    <div id="conteudoPresenca">
      <div class="form-section">
        <h3>Registros de Presença</h3>
        <p class="text-muted">Confirme os registros de entrada e saída dos funcionários</p>
      </div>
      
      <div class="table-container">
        <table class="results-table" id="tabelaPresenca">
          <thead>
            <tr>
              <th>Funcionário</th>
              <th>Cargo</th>
              <th>Entrada</th>
              <th>Saída</th>
              <th class="text-center">Status</th>
            </tr>
          </thead>
          <tbody>
          {% for presenca in presencas_registradas %}
            <tr>
              <td>
                <div class="d-flex align-items-center">
                  <strong>{{presenca.usuario.nome}}</strong>
                </div>
              </td>
              <td>{{UserRole.get_display_name(presenca.usuario.urole)}}</td>
              <td>
                <span class="text-primary font-weight-bold">{{presenca.data_entrada.strftime('%H:%M')}}</span>
              </td>
              <td>
                <span class="text-primary font-weight-bold">{{presenca.data_saida.strftime('%H:%M')}}</span>
              </td>
              <td class="text-center">
                <div class="radio-group">
                  <div class="radio-option">
                    <input class="confirmacao" type="radio" name="presenca_{{presenca.id}}" value="confirmar" id="presenca_confirmar_{{presenca.id}}">
                    <label for="presenca_confirmar_{{presenca.id}}" class="text-success">✓ Confirmar</label>
                  </div>
                  <div class="radio-option">
                    <input class="confirmacao" type="radio" name="presenca_{{presenca.id}}" value="divergencia" id="presenca_divergencia_{{presenca.id}}">
                    <label for="presenca_divergencia_{{presenca.id}}" class="text-warning">⚠ Divergência</label>
                  </div>
                  <div class="radio-option">
                    <input class="confirmacao" type="radio" name="presenca_{{presenca.id}}" value="ausencia" id="presenca_ausencia_{{presenca.id}}">
                    <label for="presenca_ausencia_{{presenca.id}}" class="text-danger">✗ Ausência</label>
                  </div>
                </div>
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div id="conteudoPlantao">
      <div class="form-section">
        <h3>Registros de Plantão</h3>
        <p class="text-muted">Confirme os plantões programados dos funcionários</p>
      </div>
      
      <div class="table-container">
        <table class="results-table" id="tabelaPlantao">
          <thead>
            <tr>
              <th>Funcionário</th>
              <th>Cargo</th>
              <th class="text-center">Status</th>
            </tr>
          </thead>
          <tbody>
          {% for plantao in plantoes_registradas %}
            <tr>
              <td>
                <div class="d-flex align-items-center">
                  <strong>{{plantao.usuario.nome}}</strong>
                </div>
              </td>
              <td>{{UserRole.get_display_name(plantao.usuario.urole)}}</td>
              <td class="text-center">
                <div class="radio-group">
                  <div class="radio-option">
                    <input class="confirmacao" type="radio" name="plantao_{{plantao.id}}" value="confirmar" id="plantao_confirmar_{{plantao.id}}">
                    <label for="plantao_confirmar_{{plantao.id}}" class="text-success">✓ Confirmar</label>
                  </div>
                  <div class="radio-option">
                    <input class="confirmacao" type="radio" name="plantao_{{plantao.id}}" value="divergencia" id="plantao_divergencia_{{plantao.id}}">
                    <label for="plantao_divergencia_{{plantao.id}}" class="text-warning">⚠ Divergência</label>
                  </div>
                  <div class="radio-option">
                    <input class="confirmacao" type="radio" name="plantao_{{plantao.id}}" value="ausencia" id="plantao_ausencia_{{plantao.id}}">
                    <label for="plantao_ausencia_{{plantao.id}}" class="text-danger">✗ Ausência</label>
                  </div>
                </div>
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="form-actions">
      <button type="submit" class="btn btn-primary btn-lg">
        <i class="icon icon-save mr-2"></i>Salvar Confirmações
      </button>
    </div>
  </form>
</div>

{% endblock %}
{% block scripts %}
  <script src="{{url_for('static', filename='js/confirmar_presenca.js')}}"></script>
{% endblock %}